<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Video Upload and Check</title>
  <style>
    /* General reset and body style */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      color: #5a5c69;
      text-align: center; /* Center the body content */
    }

    /* Navigation bar */
    nav {
      display: flex;
      align-items: center;
      justify-content: center; /* Keeps navigation items centered horizontally */
      background-color: #343a40;
      padding: 10px 20px;
    }
    nav img.site-logo {
      height: 40px;
      margin-right: 20px;
    }
    nav a {
      margin: 0 10px;
      text-decoration: none;
      color: #ffffff;
      font-weight: 500;
    }
    nav a:hover {
      text-decoration: underline;
    }

    /* Main container */
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-radius: 5px;
      text-align: center; /* Center text in the container */
    }

    /* Menu-content display toggling */
    .menu-content {
      display: none;
    }
    .menu-content.active {
      display: block;
    }

    /* Headings */
    h2, h3 {
      color: #4e73df;
    }

    /* Upload form styling */
    .upload-form {
      display: flex;
      flex-direction: column;
      align-items: center; /* Center form inputs and buttons */
      margin-top: 10px;
    }
    .upload-form label {
      margin-bottom: 5px;
      font-weight: 600;
      text-align: left;
      width: 250px;
    }
    .upload-form input[type="file"],
    .upload-form input[type="text"],
    .upload-form input[type="number"],
    .upload-form select {
      margin-bottom: 15px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 3px;
      width: 250px;
    }
    .upload-form button {
      width: 120px;
      padding: 10px;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-weight: 600;
    }
    .upload-form button:hover {
      background-color: #0056b3;
    }

    /* Spinner animation */
    .spinner {
      display: none;
      width: 50px;
      height: 50px;
      margin: 0 auto 15px auto;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Movie list and pagination */
    .movie-list {
      list-style-type: none;
      padding: 0;
      margin: 15px 0;
      text-align: left; /* List items often look better left-aligned */
      display: inline-block; /* Keep the list itself in the center */
    }
    .movie-list li {
      margin-bottom: 8px;
    }
    .movie-list a {
      color: #4e73df;
      text-decoration: none;
    }
    .movie-list a:hover {
      text-decoration: underline;
    }

    .pagination {
      margin-top: 20px;
      display: flex;
      justify-content: center;
    }
    .pagination a {
      margin: 0 5px;
      padding: 5px 10px;
      background: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 3px;
    }
    .pagination a.disabled {
      background: #ccc;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <!-- Navigation with site logo -->
  <nav>
    <img src="site-logo.png" alt="Site Logo" class="site-logo">
    <a href="#" id="upload-movie-menu">Upload Video</a>
    <a href="#" id="check-movie-menu">Check Video</a>
  </nav>

  <!-- Main content container -->
  <div class="container">

    <div id="upload-movie" class="menu-content active">
      <h2>Upload Video</h2>
      <form id="uploadForm" class="upload-form">
        <!-- Optional Theme/Title -->
        <label for="themeTitle">Theme/Title (Optional)</label>
        <input type="text" id="themeTitle" placeholder="My video title...">

        <!-- Optional Index -->
        <label for="indexInput">Index (Optional)</label>
        <input type="number" id="indexInput" placeholder="0">

        <!-- File chooser -->
        <label for="movieFile">Choose File</label>
        <input type="file" id="movieFile" required>

        <!-- Language selector -->
        <label for="language">Choose Input Language</label>
        <select id="language">
          <option value="en">English</option>
          <option value="zh">Chinese</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="it">Italian</option>
          <option value="pt">Portuguese</option>
          <option value="nl">Dutch</option>
          <option value="hi">Hindi</option>
          <option value="ja">Japanese</option>
          <option value="fi">Finnish</option>
          <option value="ko">Korean</option>
          <option value="pl">Polish</option>
          <option value="ru">Russian</option>
          <option value="tr">Turkish</option>
          <option value="uk">Ukrainian</option>
          <option value="vi">Vietnamese</option>
        </select>

        <div class="spinner" id="spinner"></div>
        <button type="submit">Upload</button>
      </form>
    </div>

    <div id="check-movie" class="menu-content">
      <h3>Video might be delayed, check later if not here:</h3>
      <ul id="movieList" class="movie-list"></ul>
      <div class="pagination">
        <a href="#" id="prevPage" class="disabled">Previous</a>
        <a href="#" id="nextPage">Next</a>
      </div>
    </div>

  </div>

  <!-- JavaScript Section -->
  <script>
    // Toggle between Upload and Check sections
    document.getElementById('upload-movie-menu').addEventListener('click', function () {
      document.getElementById('upload-movie').classList.add('active');
      document.getElementById('check-movie').classList.remove('active');
    });

    document.getElementById('check-movie-menu').addEventListener('click', function () {
      document.getElementById('check-movie').classList.add('active');
      document.getElementById('upload-movie').classList.remove('active');
      loadMovies();
    });

    // Upload form submission
    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const fileInput = document.getElementById('movieFile');
      const language = document.getElementById('language').value;

      // Grab optional fields:
      const themeTitle = document.getElementById('themeTitle').value.trim();
      const indexInput = document.getElementById('indexInput').value.trim();

      const file = fileInput.files[0];
      const fileName = file.name;

      // Show spinner
      document.getElementById('spinner').style.display = 'block';

      // Build the request body to include optional fields if not empty
      const requestBody = {
        user_name: 'testuser',
        filename: fileName,
        lang: language
      };
      if (themeTitle !== '') {
        requestBody.theme_title = themeTitle;
      }
      if (indexInput !== '') {
        requestBody.index = indexInput;
      }

      // Get Presigned URL
      fetch('https://igr9sg55zi.execute-api.us-east-1.amazonaws.com/prod/generate-upload-url', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      })
      .then(response => response.json())
      .then(data => {
        const presignedUrl = data.body.url;

        // Upload File to S3
        return fetch(presignedUrl, {
          method: 'PUT',
          headers: { 'Content-Type': 'video/mp4' },
          body: file
        });
      })
      .then(response => {
        // Hide spinner
        document.getElementById('spinner').style.display = 'none';
        if (response.status === 200) {
          alert('File uploaded successfully!');
        } else {
          alert('Failed to upload file.');
        }
      })
      .catch(error => {
        // Hide spinner on error
        document.getElementById('spinner').style.display = 'none';
        alert('Failed to get presigned URL or upload file.');
      });
    });

    // Pagination and movie listing
    let currentPage = 1;
    const resultsPerPage = 10;

    function loadMovies(page = 1) {
      currentPage = page;
      fetch('https://igr9sg55zi.execute-api.us-east-1.amazonaws.com/prod/list-latest-uploaded-video', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        const movies = data.body;
        const totalMovies = movies.length;
        const totalPages = Math.ceil(totalMovies / resultsPerPage);
        const startIndex = (page - 1) * resultsPerPage;
        const endIndex = Math.min(startIndex + resultsPerPage, totalMovies);

        const movieList = document.getElementById('movieList');
        movieList.innerHTML = '';

        for (let i = startIndex; i < endIndex; i++) {
          const movie = movies[i];
          const listItem = document.createElement('li');
          const link = document.createElement('a');
          link.href = movie.url;
          link.textContent = movie.name;
          link.target = "_blank";
          listItem.appendChild(link);
          movieList.appendChild(listItem);
        }

        // Update pagination
        document.getElementById('prevPage').classList.toggle('disabled', page === 1);
        document.getElementById('nextPage').classList.toggle('disabled', page === totalPages);
      });
    }

    document.getElementById('prevPage').addEventListener('click', function (e) {
      e.preventDefault();
      if (currentPage > 1) {
        loadMovies(currentPage - 1);
      }
    });

    document.getElementById('nextPage').addEventListener('click', function (e) {
      e.preventDefault();
      loadMovies(currentPage + 1);
    });
  </script>

</body>
</html>
